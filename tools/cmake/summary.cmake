################################################################################################
# Universal Numbers Library status report function.
# Automatically align right column and selects text based on condition.

function(universal_status text)
  set(status_cond)
  set(status_then)
  set(status_else)

  set(status_current_name "cond")
  foreach(arg ${ARGN})
    if(arg STREQUAL "THEN")
      set(status_current_name "then")
    elseif(arg STREQUAL "ELSE")
      set(status_current_name "else")
    else()
      list(APPEND status_${status_current_name} ${arg})
    endif()
  endforeach()

  if(DEFINED status_cond)
    set(status_placeholder_length 38) # if too small, you will get a wrap around in the output report
    string(RANDOM LENGTH ${status_placeholder_length} ALPHABET " " status_placeholder)
    string(LENGTH "${text}" status_text_length)
    if(status_text_length LESS status_placeholder_length)
      string(SUBSTRING "${text}${status_placeholder}" 0 ${status_placeholder_length} status_text)
    elseif(DEFINED status_then OR DEFINED status_else)
      message(STATUS "${text}")
      set(status_text "${status_placeholder}")
    else()
      set(status_text "${text}")
    endif()

    if(DEFINED status_then OR DEFINED status_else)
      if(${status_cond})
        string(REPLACE ";" " " status_then "${status_then}")
        string(REGEX REPLACE "^[ \t]+" "" status_then "${status_then}")
        message(STATUS "${status_text} ${status_then}")
      else()
        string(REPLACE ";" " " status_else "${status_else}")
        string(REGEX REPLACE "^[ \t]+" "" status_else "${status_else}")
        message(STATUS "${status_text} ${status_else}")
      endif()
    else()
      string(REPLACE ";" " " status_cond "${status_cond}")
      string(REGEX REPLACE "^[ \t]+" "" status_cond "${status_cond}")
      message(STATUS "${status_text} ${status_cond}")
    endif()
  else()
    message(STATUS "${text}")
  endif()
endfunction()

################################################################################################
# Function merging lists of compiler flags to single string.
# Usage:
#   universal_merge_flag_lists(out_variable <list1> [<list2>] [<list3>] ...)
function(universal_merge_flag_lists out_var)
  set(__result "")
  foreach(__list ${ARGN})
    foreach(__flag ${${__list}})
      string(STRIP ${__flag} __flag)
      set(__result "${__result} ${__flag}")
    endforeach()
  endforeach()
  string(STRIP ${__result} __result)
  set(${out_var} ${__result} PARENT_SCOPE)
endfunction()

####
# Prints accumulated universal arithmetic library configuration summary
# Usage:
#   universal_print_configuration_summary()

function(universal_print_configuration_summary)

    universal_merge_flag_lists(__c_flags_rel CMAKE_C_FLAGS_RELEASE CMAKE_C_FLAGS)
    universal_merge_flag_lists(__c_flags_deb CMAKE_C_FLAGS_DEBUG CMAKE_C_FLAGS)
    universal_merge_flag_lists(__cxx_flags_rel CMAKE_CXX_FLAGS_RELEASE CMAKE_CXX_FLAGS)
    universal_merge_flag_lists(__cxx_flags_deb CMAKE_CXX_FLAGS_DEBUG CMAKE_CXX_FLAGS)

    universal_status("")
    universal_status("******************* Universal Arithmetic Library Configuration Summary *******************")
    universal_status("General:")
    universal_status("  Version                          :   ${PROJECT_VERSION}")
    universal_status("  System                           :   ${CMAKE_SYSTEM_NAME}")
    universal_status("  C++ Language Requirement         :   C++${CMAKE_CXX_STANDARD}")
    universal_status("  C compiler                       :   ${CMAKE_C_COMPILER}")
    universal_status("  Release C flags                  :   ${__c_flags_rel}")
    universal_status("  Debug C flags                    :   ${__c_flags_deb}")
    universal_status("  C++ compiler                     :   ${CMAKE_CXX_COMPILER}")
    universal_status("  Release CXX flags                :   ${__cxx_flags_rel}")
    universal_status("  Debug CXX flags                  :   ${__cxx_flags_deb}")
    universal_status("  Build type                       :   ${CMAKE_BUILD_TYPE}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_ALL                        :   ${UNIVRSL_BUILD_ALL}")
    universal_status("  UNIVRSL_BUILD_CI                         :   ${UNIVRSL_BUILD_CI}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_DEMONSTRATION              :   ${UNIVRSL_BUILD_DEMONSTRATION}")
    universal_status("  UNIVRSL_BUILD_NUMBERS                    :   ${UNIVRSL_BUILD_NUMBERS}")
    universal_status("  UNIVRSL_BUILD_NUMERICS                   :   ${UNIVRSL_BUILD_NUMERICS}")
    universal_status("  UNIVRSL_BUILD_BENCHMARKS                 :   ${UNIVRSL_BUILD_BENCHMARKS}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_SDK         :   ${UNIVRSL_BUILD_MIXEDPRECISION_SDK}")
    universal_status("  UNIVRSL_BUILD_COMPLEX                    :   ${UNIVRSL_BUILD_COMPLEX}")
    universal_status("  UNIVRSL_BUILD_CONCURRENCY                :   ${UNIVRSL_BUILD_CONCURRENCY}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_CMD_LINE_TOOLS             :   ${UNIVRSL_BUILD_CMD_LINE_TOOLS}")
    universal_status("  UNIVRSL_BUILD_EDUCATION                  :   ${UNIVRSL_BUILD_EDUCATION}")
    universal_status("  UNIVRSL_BUILD_APPLICATIONS               :   ${UNIVRSL_BUILD_APPLICATIONS}")
    universal_status("  UNIVRSL_BUILD_PLAYGROUND                 :   ${UNIVRSL_BUILD_PLAYGROUND}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_NUMBER_INTERNALS           :   ${UNIVRSL_BUILD_NUMBER_INTERNALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_NATIVE_TYPES        :   ${UNIVRSL_BUILD_NUMBER_NATIVE_TYPES}")
    universal_status("  UNIVRSL_BUILD_NUMBER_ELASTICS            :   ${UNIVRSL_BUILD_NUMBER_ELASTICS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_STATICS             :   ${UNIVRSL_BUILD_NUMBER_STATICS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_CONVERSIONS         :   ${UNIVRSL_BUILD_NUMBER_CONVERSIONS}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_NUMBER_EINTEGERS           :   ${UNIVRSL_BUILD_NUMBER_EINTEGERS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_EDECIMALS           :   ${UNIVRSL_BUILD_NUMBER_EDECIMALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_ERATIONALS          :   ${UNIVRSL_BUILD_NUMBER_ERATIONALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_EFLOATS             :   ${UNIVRSL_BUILD_NUMBER_EFLOATS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_EREALS              :   ${UNIVRSL_BUILD_NUMBER_EREALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_ELREALS             :   ${UNIVRSL_BUILD_NUMBER_ELREALS}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_NUMBER_INTEGERS            :   ${UNIVRSL_BUILD_NUMBER_INTEGERS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_DECIMALS            :   ${UNIVRSL_BUILD_NUMBER_DECIMALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_RATIONALS           :   ${UNIVRSL_BUILD_NUMBER_RATIONALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_FIXPNTS             :   ${UNIVRSL_BUILD_NUMBER_FIXPNTS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_BFLOATS             :   ${UNIVRSL_BUILD_NUMBER_BFLOATS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_CFLOATS             :   ${UNIVRSL_BUILD_NUMBER_CFLOATS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_DFLOATS             :   ${UNIVRSL_BUILD_NUMBER_DFLOATS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_DOUBLE_DOUBLE       :   ${UNIVRSL_BUILD_NUMBER_DOUBLE_DOUBLE}")
    universal_status("  UNIVRSL_BUILD_NUMBER_TRIPLE_DOUBLE       :   ${UNIVRSL_BUILD_NUMBER_TRIPLE_DOUBLE}")
    universal_status("  UNIVRSL_BUILD_NUMBER_QUAD_DOUBLE         :   ${UNIVRSL_BUILD_NUMBER_QUAD_DOUBLE}")
    universal_status("  UNIVRSL_BUILD_NUMBER_AREALS              :   ${UNIVRSL_BUILD_NUMBER_AREALS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_UNUM1S              :   ${UNIVRSL_BUILD_NUMBER_UNUM1S}")
    universal_status("  UNIVRSL_BUILD_NUMBER_UNUM2S              :   ${UNIVRSL_BUILD_NUMBER_UNUM2S}")
    universal_status("  UNIVRSL_BUILD_NUMBER_POSITS              :   ${UNIVRSL_BUILD_NUMBER_POSITS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_POSITOS             :   ${UNIVRSL_BUILD_NUMBER_POSITOS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_VALIDS              :   ${UNIVRSL_BUILD_NUMBER_VALIDS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_TAKUMS              :   ${UNIVRSL_BUILD_NUMBER_TAKUMS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_LNS                 :   ${UNIVRSL_BUILD_NUMBER_LNS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_DBNS                :   ${UNIVRSL_BUILD_NUMBER_DBNS}")
    universal_status("  UNIVRSL_BUILD_NUMBER_SORNS               :   ${UNIVRSL_BUILD_NUMBER_SORNS}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_TYPE_HIERARCHY             :   ${UNIVRSL_BUILD_TYPE_HIERARCHY}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_NUMERIC_FUNCTIONS          :   ${UNIVRSL_BUILD_NUMERIC_FUNCTIONS}")
    universal_status("  UNIVRSL_BUILD_NUMERIC_QUIRES             :   ${UNIVRSL_BUILD_NUMERIC_QUIRES}")
    universal_status("  UNIVRSL_BUILD_NUMERIC_CHALLENGES         :   ${UNIVRSL_BUILD_NUMERIC_CHALLENGES}")
    universal_status("  UNIVRSL_BUILD_NUMERIC_UTILS              :   ${UNIVRSL_BUILD_NUMERIC_UTILS}")
    universal_status("  UNIVRSL_BUILD_NUMERIC_FPBENCH            :   ${UNIVRSL_BUILD_NUMERIC_FPBENCH}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_BENCHMARK_ERROR            :   ${UNIVRSL_BUILD_BENCHMARK_ERROR}")
    universal_status("  UNIVRSL_BUILD_BENCHMARK_ACCURACY         :   ${UNIVRSL_BUILD_BENCHMARK_ACCURACY}")
    universal_status("  UNIVRSL_BUILD_BENCHMARK_REPRODUCIBILITY  :   ${UNIVRSL_BUILD_BENCHMARK_REPRODUCIBILITY}")
    universal_status("  UNIVRSL_BUILD_BENCHMARK_PERFORMANCE      :   ${UNIVRSL_BUILD_BENCHMARK_PERFORMANCE}")
    universal_status("  UNIVRSL_BUILD_BENCHMARK_ENERGY           :   ${UNIVRSL_BUILD_BENCHMARK_ENERGY}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_ROOTS       :   ${UNIVRSL_BUILD_MIXEDPRECISION_ROOTS}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_APPROXIMATE :   ${UNIVRSL_BUILD_MIXEDPRECISION_APPROXIMATE}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_INTEGRATE   :   ${UNIVRSL_BUILD_MIXEDPRECISION_INTEGRATE}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_INTERPOLATE :   ${UNIVRSL_BUILD_MIXEDPRECISION_INTERPOLATE}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_OPTIMIZE    :   ${UNIVRSL_BUILD_MIXEDPRECISION_OPTIMIZE}")
    universal_status("  UNIVRSL_BUILD_MIXEDPRECISION_TENSOR      :   ${UNIVRSL_BUILD_MIXEDPRECISION_TENSOR}")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_LINEAR_ALGEBRA_BLAS        :   ${UNIVRSL_BUILD_LINEAR_ALGEBRA_BLAS}")
    universal_status("  UNIVRSL_BUILD_LINEAR_ALGEBRA_VMATH       :   ${UNIVRSL_BUILD_LINEAR_ALGEBRA_VMATH}")
    universal_status("  UNIVRSL_BUILD_LINEAR_ALGEBRA_DATA        :   ${UNIVRSL_BUILD_LINEAR_ALGEBRA_DATA}")
    universal_status("")
    universal_status("")
    universal_status("  UNIVRSL_BUILD_C_API_PURE_LIB             :   ${UNIVRSL_BUILD_C_API_PURE_LIB}")
    universal_status("  UNIVRSL_BUILD_C_API_SHIM_LIB             :   ${UNIVRSL_BUILD_C_API_SHIM_LIB}")
    universal_status("  UNIVRSL_BUILD_C_API_LIB_PIC              :   ${UNIVRSL_BUILD_C_API_LIB_PIC}")
    universal_status("  UNIVRSL_BUILD_DOCS                       :   ${UNIVRSL_BUILD_DOCS}")
    universal_status("")
    universal_status("Regression Testing Level:")
    if(UNIVRSL_BUILD_REGRESSION_STRESS)
	    universal_status("  UNIVRSL_BUILD_REGRESSION_STRESS          :   ${UNIVRSL_BUILD_REGRESSION_STRESS}")
    elseif(UNIVRSL_BUILD_REGRESSION_SANITY AND (UNIVRSL_BUILD_REGRESSION_LEVEL_2 STREQUAL OFF) AND (UNIVRSL_BUILD_REGRESSION_LEVEL_3 STREQUAL OFF) AND (UNIVRSL_BUILD_REGRESSION_LEVEL_4 STREQUAL OFF))
	    universal_status("  UNIVRSL_BUILD_REGRESSION_SANITY          :   ${UNIVRSL_BUILD_REGRESSION_SANITY}")
    else()
	    universal_status("  UNIVRSL_BUILD_REGRESSION_LEVEL_1         :   ${UNIVRSL_BUILD_REGRESSION_LEVEL_1}")
	    universal_status("  UNIVRSL_BUILD_REGRESSION_LEVEL_2         :   ${UNIVRSL_BUILD_REGRESSION_LEVEL_2}")
	    universal_status("  UNIVRSL_BUILD_REGRESSION_LEVEL_3         :   ${UNIVRSL_BUILD_REGRESSION_LEVEL_3}")
	    universal_status("  UNIVRSL_BUILD_REGRESSION_LEVEL_4         :   ${UNIVRSL_BUILD_REGRESSION_LEVEL_4}")
    endif()
    universal_status("")
    universal_status("Dependencies:")
    universal_status("  SSE3                             : " UNIVRSL_USE_SSE3 AND COMPILER_HAS_SSE3_FLAG THEN "YES" ELSE "NO")
    universal_status("  AVX                              : " UNIVRSL_USE_AVX AND COMPILER_HAS_AVX_FLAG THEN "YES" ELSE "NO")
    universal_status("  AVX2                             : " UNIVRSL_USE_AVX2 AND COMPILER_HAS_AVX2_FLAG THEN "YES" ELSE "NO")
    universal_status("  Pthread                          : " UNIVRSL_USE_PTHREAD THEN "YES" ELSE "NO")
    universal_status("  TBB                              : " UNIVRSL_USE_TBB AND TBB_FOUND THEN "YES (ver. ${TBB_INTERFACE_VERSION})" ELSE "NO")
    universal_status("  OMP                              : " UNIVRSL_USE_OMP AND OMP_FOUND THEN "YES" ELSE "NO")
    universal_status("")
    universal_status("Utilities:")
    universal_status("  Serializer                       : " UNIVRSL_USE_SERIALIZER THEN "YES" ELSE "NO")
    universal_status("")
    universal_status("Install:")
    universal_status("  Install path                     :   ${CMAKE_INSTALL_PREFIX}")
    universal_status("")
endfunction()
